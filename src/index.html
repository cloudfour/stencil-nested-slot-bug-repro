<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
  <title>Stencil Component Starter</title>

  <script type="module" src="/build/bug-repro.esm.js"></script>
  <script nomodule src="/build/bug-repro.js"></script>
</head>

<body>
  <h1></h1>

  <p>
    This is a simple test case for an issue I'm running into with Stencil's
    virtual DOM implementation and nested slots. Here's the issue I'm running into:
  </p>

  <ol>
    <li>A parent component's template includes a child component.</li>
    <li>The parent's slot is passed into the child component.</li>
    <li>A prop on the child component is set based on the state of the parent component.</li>
    <li>When the parent's state changes, the child's prop changes, triggering re-renders in both components.</li>
    <li>When the components re-render the slot moves in the DOM order.</li>
    <li>This breaks things like video playback in iframes.</li>
  </ol>

  <p>
    I would expect the virtual DOM implementation to realize there have been
    no changes to the slotted iframe and leave it alone during the re-render.
  </p>

  <p>
    (I'm not using shadow DOM if that's relevant)
  </p>

  <my-component>
    <h1>Slot</h1>
  </my-component>

  <p>
    To test this, press the Update State button.
    The <code>h1</code> moves in the DOM order (but shouldn't).
  </p>

  <p>I originally ran into this in a more complex component, where it was breaking iframe playback:</p>

  <my-component>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/kx_LgXd0uAk" title="YouTube video player"
      frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen></iframe>
  </my-component>
</body>

</html>
